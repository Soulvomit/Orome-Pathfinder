     1                                  [BITS 64]
     2                                  [SECTION .text]
     3                                  [GLOBAL _Node2D.CalcManhattanDistance]
     4                                  [GLOBAL _Node2D.GetByCoordinates]
     5                                  ;From Node
     6                                  [EXTERN Node.Position.X]
     7                                  [EXTERN Node.Position.Y]
     8                                  [EXTERN Node.Size]
     9                                  [EXTERN NodeStack.Bottom]
    10                                  [DEFAULT REL]
    11                                  
    12                                  _Node2D:
    13                                  	;Uses r8-r15 as temp storage 
    14                                  	;Params: rax = Node1, rbx = Node2
    15                                  	;Return: rcx = vManhattanDistance
    16                                  	.CalcManhattanDistance:
    17 00000000 66448B80[00000000]      		mov r8w, [rax + Node.Position.X] 
    18 00000008 66448B88[00000000]      		mov r9w, [rax + Node.Position.Y]
    19 00000010 66442B83[00000000]      		sub r8w, [rbx + Node.Position.X] 
    20 00000018 66442B8B[00000000]      		sub r9w, [rbx + Node.Position.Y]
    21                                  		;abs r8
    22 00000020 664589C2                		mov r10w, r8w 
    23 00000024 6641F7D8                		neg r8w
    24 00000028 66450F4CC2              		cmovl r8w, r10w
    25                                  		;abs r9
    26 0000002D 664589CA                		mov r10w, r9w
    27 00000031 6641F7D9                		neg r9w
    28 00000035 66450F4CCA              		cmovl r9w, r10w
    29                                  		;store return value in rcx and ret
    30 0000003A 4981E0FFFF0000          		and r8, 0xFFFF
    31 00000041 4981E1FFFF0000          		and r9, 0xFFFF
    32 00000048 4C89C1                  		mov rcx, r8
    33 0000004B 4C01C9                  		add rcx, r9
    34 0000004E C3                      		ret
    35                                  		
    36                                  	;Uses r8-r15 as temp storage.
    37                                  	;Params: ax = Node.Position.X; bx = Node.Position.Y, dx = Grid.Width
    38                                  	;Return: rcx = Node Pointer
    39                                  	.GetByCoordinates:
    40 0000004F 4989D8                  		mov r8, rbx
    41 00000052 4C0FAFC2                		imul r8, rdx
    42 00000056 4901C0                  		add r8, rax
    43 00000059 4D69C0[00000000]        		imul r8, Node.Size
    44 00000060 488B8D[00000000]        		mov rcx, [rbp + NodeStack.Bottom]
    45 00000067 4C29C1                  		sub rcx, r8
    46 0000006A C3                      		ret
